# Virtual memory
- 프로세스가 메모리에 완전히 올라가 있지 않더라도 실행할 수 있게 해 주는 기술
- 이로 인해 프로그램이 물리 메모리보다 클 수 있다.
- 메인 메모리를 매우 큰 저장소 배열로 추상화하여 논리 메모리와 물리 메모리를 구분짓는다.
- 파일, 라이브러리 공유 및 파일 생성에 효율적인 메커니즘 제공

# 가상 주소 공간
- 프로세스가 메모리에 어떻게 저장되는지에 대한 논리적 관점
- 일반적으로 주소 0번부터 시작하며, 연속적임

# 가상 메모리
- page sharing을 통해 여러 프로세스가 파일과 메모리를 공유하도록 허용

# 요구 페이징
- 가상 메모리 시스템에서, 실행 중인 프로그램이 요청할 경우에만 페이지를 로드하는 기술
- 프로세스가 실행 중일 때, 어떤 페이지는 메모리에, 어떤 페이지는 보조 저장장치에 있을 것
- 이 두 저장 상태를 구별하기 위해, valid-invalid bit가 사용됨
	- valid: 페이지가 유효하고 메모리에 있음
	- invalid: 페이지가 유효하지 않거나 보조 저장장치에 있음
- valid-invalid bit(dirty bit)는 page table에 표시됨
- 보조 저장장치는 메인 메모리에 있지 않은 페이지를 저장하며, 스왑 공간이라고도 함

# Page fault를 처리하는 과정
- 프로세스가 메모리에 올라와 있지 않은 페이지에 접근할 경우, page fault trap 발생
- 프로세스의 내부 테이블을 확인해서 메모리 참조가 유효한지 아닌지 결정
- 참조가 무효할 경우, 프로세스 중단
- 유효하지만 아직 메모리에 올라오지 않은 경우, page를 in하게 됨
	- 먼저 빈 프레임을 찾음
		- 빈 프레임이 없다면 page replacement algorithm으로 희생자(victim)를 고름
		- 희생자 프레임의 값을 보조 저장장치에 쓰고, 페이지 테이블 값을 변경
	- 새로 할당된 프레임에 적절한 page를 읽기 위한 보조 저장장치 연산을 스케줄링함
	- read 연산이 끝나면 프로세스의 내부 테이블과 페이지 테이블을 수정
	- 명령어 다시 수행
	
# Pure Demand Paging
- 요구할 때까지 페이지를 메모리로 가져오지 않음
- 메모리에 아무 페이지도 없는 상태에서 프로세스를 실행하게 됨
- 그때그때 페이지를 가져오므로 비효율적

# 참조의 지역성
- 요구 페이징 방식은 한 명령어 실행에 여러 page fault를 일으킬 가능성이 있음
- 그러나 분석 결과, 프로세스에서 이런 경우는 발생 가능성이 낮다는 것이 밝혀짐
- 프로그램은 참조의 지역성으로 인해 요구 페이징으로도 합리적인 퍼포먼스를 낼 수 있음
- 적절한 자료구조 및 프로그램 구조는 코드, 데이터의 지역성을 높이므로, page fault 발생률을 낮추어 시스템 퍼포먼스 향상

# 명령 재시작
- page fault 발생 후 명령어를 재시작하는 능력
- page fault가 발생할 때, trap이 발생한 프로세스의 상태를 저장하고, wait queue로 보냄
- page in 완료 후에는 해당 프로세스에 signal을 보내 CPU에 재할당하도록 함

# Free frame List
- page fault가 발생할 때, OS는 보조 저장장치의 적합한 페이지를 메모리로 가져와야 함
- page fault를 해결하기 위해, OS에서 사용 가능한 free frame pool을 관리함
- 프로세스의 stack이나 heap 세그먼트가 늘어날 경우에도 free frame이 할당됨

# Page replacement
- free frame이 없을 경우, 현재 사용되지 않는 frame을 찾아서 비움
- 새로 필요한 페이지를 그 frame에 쓰고, 페이지 테이블의 dirty bit 값을 변경

## FIFO Page replacement
- 페이지를 교체해야 할 경우, 가장 오래된 페이지를 선택
- Belady's Anomaly 발생 가능

### Belady's Anomaly
- 할당할 프레임의 개수가 증가하면 오히려 page fault 빈도가 증가하는 현상

## Optimal Page replacement
- page fault가 적게 발생하는 최적의 알고리즘을 찾음

### OPT
- 앞으로 가장 안 쓸 것 같은 페이지를 교체
- 낮은 page fault 발생 빈도 보장
- 교체할 페이지를 알기 어려움

## LRU Page replacement
- 최근에 사용되지 않은 페이지를 교체
- 알고리즘 구현의 어려움 -> 하드웨어 지원 필요
	- 카운터를 통한 구현
	- 스택을 통한 구현

# Thrashing
- 빈번한 페이지 교체로 인해 CPU 사용률이 낮아지는 현상
- multiprogramming 환경에서 여러 프로세스가 동작하거나, 또는 프로세스가 요구하는 페이지가 많을 경우, 페이지 교체가 빈번하게 일어나게 되고, 이로 인해 프로세스의 CPU 할당이 좀처럼 일어나지 않게 됨
