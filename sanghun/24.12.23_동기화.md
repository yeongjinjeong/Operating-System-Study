# 동기화 필요성
* 공유데이터에 다수 스레드의 동시 접근하게 된다면 공유 데이터가 훼손될 수 있다.(race condition)

## 스레드 동기화
* 다수의 스레드가 공유 데이터를 동시에 쓰는 충돌 상황에서 공유 데이터가 훼손되지 않게 하는 제어 기법

## 해결책
* 한 스레드가 공유 데이터에 대한 사용을 마칠 때까지 다른 스레드 접근하지 못하도록 제어한다.

## 임계구역과 상호배제


### 임계구역(critical section)
* 프로그램 중 공유 데이터에 접근하는 코드 블록

### 상호배제(mutual exclusion)
* 임계구역은 반드시 한 스레드만 배타적 독점적으로 실행하도록 관리 되어야한다.
* 일반코드(non-critical) : 공유 데이터를 엑세스하지 않는 코드 부분
* 임계구역 진입코드(entry 코드) : 임계구역에 진입하기 전 필요한 코드블록
* 임계구역 진출코드(exit 코드) : 임계구역 실행을 마칠 때 실행 되어야 하는 코드블록
* 임계구역 코드( critical 코드) : 공유데이터에 접근하는 코드블록, 한 번에 한 스레드만 실행

### 상호배제 구현
* 임계구역에 오직 한 스레드만 들어가게 하는 방책
1. 소프트웨어적 방법 : preterson's 알고리즘 등
2. 하드웨어적 방법 : 인터럽트 서비스 금지, 원자명령

> 오늘날에는 하드웨어적 방법을 사용 보통 원자명령을 활용

#### Peterson's 알고리즘
* 동작 원리
1. 각 프로세스는 임계 영역 진입 전에 자신의 flag를 true로 설정
2. turn 변수를 상대방 번호로 설정하여 양보
3. while 루프에서 상대방의 진입 의도와 turn을 확인
4. 임계 영역 종료 후 자신의 flag를 false로 설정
> 사실상 turn변수도 공유데이터이므로 수정할때 원자성이 보장되어야 한다.

#### 인터럽트 서비스 금지
* 임계구역으로 집입할 때 entry에서 인터럽트 서비스 금지하고 exit에서 인터럽트 서비스 허용
* 임계구역 실행동안 인터럽트 발생하지 않아 선점(preemption)되지 않는다.
* 문제점
    - 임계구역을 실행하는 동안 모든 인터럽트가 무시된다.
    - 단일 cpu에서는 활용가능하지만 다중 cpu 시스템에서 활용불가 : 다른 코어의 인터럽트 서비스를 막지 못한다.
#### 원자명령(atmoic instruction)
* 상호배제를 위해만든 cpu명령
* lock변수를 만들어서 사용할때 lock 값을 읽는 명령과 저장명령을 하나의 명령으로 만드는 것
> cpu는 명령을 실행 중일 때 인터럽트 발행해도 현재 명령까지는 실행하고 인터럽트 서비스한다.
